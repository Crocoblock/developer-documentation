# JetEngine. Macros Handler

**Location:** /framework/macros/macros-handler.php

Класс `\Crocoblock\Macros_Handler` фактично є компонентом фреймворка, а не саме JetEngine, тому може бути використаний в будь-якуому іншому плагіні де треба додати врасну обробку макросів

Методи класу:

`__construct( $namespace )`
Конструктор задає $namespace для поточного екземпляру. Якщо задано $namespace, то на базі нього будуть викликатися хуки для реєстрації валних макросів для поточного екземпляру Macros_Handler. В самому JetEngine на даний момент не використовується на користь власного хука з JetEngine для сумісності з легасі макросами

`register_macros_list( $list = [] )`
Метод для групової реєстрації макросів для поточного екземпляру Macros_Handler. Кожен екземпляр Macros_Handler може обробляти тільки ті макроси які в ньому зареєстровані. Формат списку для реєстрації
```php
[
	'macros_tag' => [
		'label' => 'Macros Name',
		'cb'    => 'callback_function_name',
		'args'  => [
			'arg_1' => [
				'label'   => __( 'Field', 'jet-engine' ),
				'type'    => 'select',
				'options' => $options, // This could be an array or callable function to retrieve options list only for UI
			]
			'arg_2' => [
				'label'   => __( 'Return', 'jet-engine' ),
				'type'    => 'text',
			],
		],
	],
]
```
Також, якщо задано неймспейс, цей метод викликає хук `$this->namespace . '/register-macros'`, для реєстрації кастомних макросів саме в цьому єкземплярі Macros_Handler

`register_macros( $macros_instance )`
Реєструє окремий макрос через класс макроса. Класс макроса має розширювати базовий класс `\Crocoblock\Base_Macros`. Приклад використання цього методу разом з хуком з попреднього методу:
```php
add_action( 'my-namespace/register-macros', function( $handler ) {

	if ( ! class_exists( '\Crocoblock\Base_Macros' ) ) {
		require_once 'path/to/base-macros.php';
	}

	require_once 'path/to/my-macros-1.php';
	require_once 'path/to/my-macros-2.php';

	$handler->register_macros( new My_Macros_1() );
	$handler->register_macros( new My_Macros_2() );

} );
```
Цей метод можна використовувати для реєєстрації всіх макросів для вашого середовища, але обов'язково *після цього* викликади метод `register_macros_list()` на поточному екземплярі Macros_Handler, щоб викликати сам хук.

Класс `\Crocoblock\Base_Macros` також можна підключити як модуль фреймоврка.

`get_raw_list()`
Повертає список макросів як є. Цей метод бажано використовувати там, де вам треба отримати список всіх макросів і не додавати ЮІ для них

`get_escaped_list()`
Повертає список макросів, у якому опції аргментів підготовленні для використання (для тих випдаків, де в якості опції було передано колбек). Цей метод бажано використовувати там де ви планєте створювати ЮІ для макросів.

`get_macros_for_js()`
Повертає список макросів у форматі, підготовленному для використання в ЖС компонентах

`set_macros_context( $context )`
Встановлює контекст макроса. Зі строки макроса можна встановити лише текстовий контекст, такий контекст може обробляти лише JetEngine. Але програмно можна задати будь-який контекст, якщо в якості контексту передати відразу потрібний об'єкт а не назву контексту.

`get_macros_context()`
Повертає поточний контекст - текстову назву контексту, або об'єкт

`set_fallback( $fallback )`
Задає текст який буде викорситано в якості значення макросу, якщо актуальне занчення порожнє. Фолбек можна передати зі строкою макросу в такому форматі - `%my_macros%{"fallback":"My Fallback"}`

`get_fallback()`
Повертає поточний фолбек

`set_before( $before )`
Задає текст який буде додано перед занченням макросу. Це значення можна передати зі строкою макросу в такому форматі - `%my_macros%{"before":"Text before macros value"}`

`get_before()`
Повертає поточне значення before

`set_after( $after )`
Задає текст який буде додано після занчення макросу. Це значення можна передати зі строкою макросу в такому форматі - `%my_macros%{"after":"Text after macros value"}`


`get_after()`
Повертає поточне значення after

`get_macros_list_for_options()`
Повертає список макросів для використання в якості опцій у форматі macros_slug => Macros name

`verbose_macros_list()`
Повертає спсиок назв доступних макросів у вигляді строки, розділеної комами

`get_macros_object()`
Повертає поточний об'єкт для макросу, який визначається за контекстом (або сам контекст, якщо перед цим ми через set_macros_context передали готовий об'єкт)

`call_macros_func( $macros, $args = array() )`
Викликає функцію для перданого в 1му аргументі макросу зі списком аргументів, переданим у другому агументі.

`do_macros( $string, $field_value )`
Виконує всі макроси в переданому аргументі $string. Цей метод необхідно додати всюди де ви бажаєте додати підтримку максроів з поточного екземпляру `\Crocoblock\Macros_Handler`. `$field_value` - це здебільшого легасі параметр, що тягенться с реалізації макросів в JetEngine, але за бажання можно передавати через нього будь-якиі глобальні аргументи котрі потрібні для всіх макросів.
